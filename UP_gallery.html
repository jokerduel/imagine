<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Magi-Nation - Unprinted Gallery</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="site.css">
</head>
<body link="#2222ff" vlink="#2222ff">
<center>
  <a href="index.html"><img src="indeximages/logo.jpg" border="0" style="max-width:900px;width:100%"></a>
  <h2>Unprinted</h2>
<h3 class="region-header" style="color:#0099CC;">Arderial</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Sorreah_Warrior.webp"  data-full="cardimages/UP/Sorreah_Warrior.png" alt="Sorreah, Warrior" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#006666;">Bograth</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Sludge_Hyren.webp"  data-full="cardimages/UP/Sludge_Hyren.png" alt="Sludge Hyren" data-color="#AAAAAA">
  <img class="gallery-image" src="thumbnails/UP/Blygts_Ring.webp"  data-full="cardimages/UP/Blygts_Ring.png" alt="Blygt's Ring" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#800080;">Core</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Twilight_Mowat_CO.webp"  data-full="cardimages/UP/Twilight_Mowat_CO.png" alt="Twilight Mowat" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#CC9900;">d'Resh</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Twilight_Mowat_DR.webp"  data-full="cardimages/UP/Twilight_Mowat_DR.png" alt="Twilight Mowat" data-color="#AAAAAA">
  <img class="gallery-image" src="thumbnails/UP/Cactus_Hyren.webp"  data-full="cardimages/UP/Cactus_Hyren.png" alt="Cactus Hyren" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#252580;">Kybar's Teeth</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Granite_Hyren.webp"  data-full="cardimages/UP/Granite_Hyren.png" alt="Granite Hyren" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#99CCFF;">Nar</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Tundra_Hyren.webp"  data-full="cardimages/UP/Tundra_Hyren.png" alt="Tundra Hyren" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#CCCC00;">Paradwyn</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Canopy_Hyren.webp"  data-full="cardimages/UP/Canopy_Hyren.png" alt="Canopy Hyren" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#FF9900;">Universal</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Traitors_Reach.webp"  data-full="cardimages/UP/Traitors_Reach.png" alt="Traitor's Reach" data-color="#AAAAAA">
</div>
<h3 class="region-header" style="color:#00CC66;">Weave</h3>
<div class="gallery-container">
  <img class="gallery-image" src="thumbnails/UP/Snag_Hyren.webp"  data-full="cardimages/UP/Snag_Hyren.png" alt="Snag Hyren" data-color="#AAAAAA">
</div>

<!-- Modal Viewer -->
<div id="modal" class="modal">
  <span id="close" class="modal-close">&times;</span>
  <span id="prev" class="modal-arrow left">&#10094;</span>
  <span id="next" class="modal-arrow right">&#10095;</span>
  <div class="modal-content-wrapper">
    <img class="modal-content" id="modal-img">
  </div>
  <div id="caption"></div>
</div>


<script>
  const images = document.querySelectorAll(".gallery-image");
  const modal = document.getElementById("modal");
  const modalImg = document.getElementById("modal-img");
  const captionText = document.getElementById("caption");
  const closeBtn = document.getElementById("close");
  const prevBtn = document.getElementById("prev");
  const nextBtn = document.getElementById("next");
  let currentIndex = -1;
  let modalIsOpen = false;
  let touchStartX = 0;
  let touchEndX = 0;
  let isDragging = false;
  let currentTranslate = 0;
  let modalImgWrapper = document.querySelector(".modal-content-wrapper");
  
  const showModal = (index) => {
    const img = images[index];
    modal.style.display = "flex";
    modalImg.src = img.dataset.full;
    captionText.textContent = img.alt;
    captionText.style.color = img.dataset.color || "#fff";
    currentIndex = index;
    
    if(!modalIsOpen) {
      history.pushState({ modal: true }, "");
    }
    modalIsOpen = true;
    

    // Preload the next full image
    const preloadNext = (index + 1) % images.length;
    const preloadImg = new Image();
    preloadImg.src = images[preloadNext].dataset.full;
    // Reset image position and transition (important for swipe)
    modalImg.style.transform = "translateX(0)";
    modalImg.style.transition = "none";
  };

  const closeModal = () => {
    if (!modalIsOpen) return;
    modal.style.display = "none";
    modalIsOpen = false;
    if (history.state && history.state.modal) {
      history.back();
    }
  };

  images.forEach((img, i) => {
    img.addEventListener("click", () => showModal(i));
  });

  const navigate = (dir) => {
    if (images.length === 0) return;
    currentIndex = (currentIndex + dir + images.length) % images.length;
    showModal(currentIndex);
  };

  closeBtn.onclick = closeModal;
  modal.onclick = (e) => { if (e.target === modal) closeModal(); };
  nextBtn.onclick = () => navigate(1);
  prevBtn.onclick = () => navigate(-1);

  document.addEventListener("keydown", (e) => {
    if (!modalIsOpen) return;
    if (e.key === "Escape") closeModal();
    else if (e.key === "ArrowRight") navigate(1);
    else if (e.key === "ArrowLeft") navigate(-1);
  });

  window.addEventListener("popstate", (e) => {
    if (modalIsOpen && (!e.state || !e.state.modal)) {
      closeModal();
    }
  });
  
  modal.addEventListener("touchstart", (e) => {
    touchStartX = e.changedTouches[0].screenX;
    isDragging = true;
  });

  modal.addEventListener("touchmove", (e) => {
    if (!isDragging) return;
    const touchX = e.changedTouches[0].screenX;
    const dragDelta = touchX - touchStartX;
    currentTranslate = dragDelta;
    modalImg.style.transform = `translateX(${currentTranslate}px)`;
  });

  modal.addEventListener("touchend", (e) => {
    touchEndX = e.changedTouches[0].screenX;
    isDragging = false;

    const deltaX = touchEndX - touchStartX;
    const swipeThreshold = 50;

    // Reset image position
    modalImg.style.transition = "transform 0.2s ease";
    modalImg.style.transform = "translateX(0)";
    setTimeout(() => {
      modalImg.style.transition = ""; // Clear it so it's smooth for next interaction
    }, 200);

    if (Math.abs(deltaX) > swipeThreshold) {
      if (deltaX < 0) {
        navigate(1); // Swipe left
      } else {
        navigate(-1); // Swipe right
      }
    }
  });


  function handleSwipeGesture() {
    const deltaX = touchEndX - touchStartX;
    const swipeThreshold = 50; // Minimum distance in px

    if (Math.abs(deltaX) > swipeThreshold) {
      if (deltaX < 0) {
        navigate(1); // Swipe left → next
      } else {
        navigate(-1); // Swipe right → previous
      }
    }
  }
</script>

</p><hr><p style="font-size:8pt">
A Magi-Nation fan site for image generation<br>
</p>
</center>
</body>
</html>